const initialTasks=[{id:0,name:"Visit Spain",description:"Visit Madrid, Barcelona. Also visit El Classico",priority:1,isDone:!0,deadline:"2023-10-13 17:27",category:"Travelling"},{id:1,name:"Build PC",description:"Need more than $2000",priority:3,isDone:!1,deadline:"2022-11-01 18:00",category:"Hobby"},{id:2,name:"Rent an apartment in Moscow",description:null,priority:5,isDone:!1,deadline:"2022-12-31 21:00",category:"Lifestyle"},{id:3,name:"Buy a Monitor",description:null,priority:2,isDone:!0,deadline:"2022-09-30 21:00",category:"Hobby"},{id:4,name:"Read the book",description:null,priority:4,isDone:!0,deadline:"2022-09-23 21:00",category:"Hobby"},{id:5,name:"Meet with Gleb",description:null,priority:2,isDone:!0,deadline:"2022-08-23 21:00",category:"Lifestyle"}],funcDebounce=function(e,t){let a;return function(){const n=()=>{e.apply(this,arguments)};clearTimeout(a),a=setTimeout(n,t)}},checkStrForEmpty=e=>""===e.replace(/ +?/g,""),checkStrForValid=(e,t)=>null===e.match(t),state={aside:!1,modal:{isOpen:!1,type:null},tasks:[],filteredTasks:[],categories:["See All"],filter:{sort:null,searchQuery:null,category:"See All"}},setAside=e=>state.aside=e,setModal=e=>state.modal={...e},setFilter=(e={})=>state.filter={...state.filter,...e},setCategories=(e=null)=>{state.categories=[...new Set([...state.categories,...state.tasks.map((e=>e.category))])],null!==e&&(state.categories=[...new Set([...state.categories,e])])},setTasks=(e=[])=>state.tasks=[...state.tasks,...e],updateTask=(e,t)=>{state.tasks.forEach(((a,n)=>{a.id===e&&state.tasks.splice(n,1,{...a,...t})}))},deleteTask=e=>{state.tasks.forEach(((t,a)=>{t.id===e&&state.tasks.splice(a,1)}))},setFilteredTasks=(e=state.tasks,t=state.filter)=>{const a=function(e,t){return null===t?e:"name"===t?[...e].sort(((e,t)=>e.name.localeCompare(t.name))):"deadline"===t?[...e].sort(((e,t)=>new Date(e.deadline).getTime()-new Date(t.deadline).getTime())):"priority (asc)"===t?[...e].sort(((e,t)=>e.priority-t.priority)):"priority (desc)"===t?[...e].sort(((e,t)=>t.priority-e.priority)):"status"===t?[...e].sort(((e,t)=>t.isDone-e.isDone)):"description"===t?[...e].sort(((e,t)=>(e.description||"")-(t.description||""))):void 0}(e,t.sort),n=function(e,t){return null===t?e:e.filter((e=>e.name.toLowerCase().includes(t.toLowerCase())))}(a,t.searchQuery),i=function(e,t){return"See All"===t?e:e.filter((e=>e.category===t))}(n,t.category);state.filteredTasks=i},$aside=document.querySelector("[data-name='aside']"),$asideColumn=document.querySelector("[data-name='asideColumn']"),$asideNav=document.querySelector("[data-name='asideNav']"),$buttonAdd=document.querySelector("[data-action='addTask']"),$buttonMenu=document.querySelector("[data-action='manageMenu']"),$inputSearch=document.querySelector("[data-action='searchTasks']"),$list=document.querySelector("[data-name='list']"),$main=document.querySelector("[data-name='main']"),$selectSort=document.querySelector("[data-action='sortTasks']"),$todo=document.querySelector("[data-name='todo']"),updateAside=()=>{state.aside?($aside.classList.add("aside_active"),$buttonMenu.classList.add("header__button_active"),$todo.classList.add("todo_disabled")):($aside.classList.remove("aside_active"),$buttonMenu.classList.remove("header__button_active"),$todo.classList.remove("todo_disabled"))},updateList=()=>{const e=function(){const e=parseInt(this.getAttribute("data-id")),t=state.tasks.filter((t=>t.id===e))[0];setModal({isOpen:!0,type:"update"}),openModal(t)},t=e=>{const t=e.target.checked,a=parseInt(e.target.getAttribute("data-id"));updateTask(a,{isDone:t}),setFilteredTasks(),updateList()},a=function(){const e=parseInt(this.getAttribute("data-id"));deleteTask(e),setFilteredTasks(),updateList()};console.log("Tasks:",state.filteredTasks),$list.innerHTML="",state.filteredTasks.forEach((e=>{const t=document.createElement("div");var a,n,i,s;t.classList.add("list__task","task"),t.innerHTML=`\n            <div class="task__row flex flex_align_center">\n                <label class="task__label">\n                    ${i=(a=e).id,s=a.isDone,s?`<input type="checkbox" data-action="updateTaskIsDone" checked data-id="${i}">`:`<input type="checkbox" data-action="updateTaskIsDone" data-id="${i}">`}\n                    <span class="task__checkmark"></span>\n                </label>\n                <img class="task__icon" src="img/priorities/${a.priority}.svg" ${function(e){let t="";switch(e){case 1:t="alt='very-low' title='Very Low Priority'";break;case 2:t="alt='low' title='Low Priority'";break;case 3:t="alt='medium' title='Medium Priority'";break;case 4:t="alt='high' title='High Priority'";break;case 5:t="alt='very-high' title='Very High Priority'"}return t}(a.priority)}>\n                <h2 class="task__name">${a.name}</h2>\n                <div class="task__date-block flex flex_align_center">\n                    <img class="task__icon" src="img/calendar.svg" alt="Calendar">\n                    <span class="task__date-value">${function(e){const t=new Date(e).getTime()-Date.now(),a=new Date(e).getMonth();let n=30;return[0,2,4,6,7,9,11].includes(a)&&(n+=1),t>=31536e6?"year+":t>=864e5*n?"month+":t>=6048e5?"week+":t>=864e5?"day+":t>=36e5?"hour+":t>=6e4?"minute+":"overdue"}(a.deadline)}</span>\n                </div>\n                <span class="task__category">\n                    ${a.category}\n                </span>\n                <div class="task__column">\n                    <button class="task__button button button_style_transparent" data-id="${a.id}"\n                        data-action="updateTask">\n                        <img class="task__icon" src="img/info.svg" alt="info" title="Update Task">\n                    </button>\n                    <button class="task__button button button_style_transparent" data-id="${a.id}"\n                        data-action="deleteTask">\n                        <img class="task__icon" src="img/remove.svg" alt="remove" title="Delete Task">\n                    </button>\n                </div>\n            </div>\n            ${n=a.description,n?`\n                    <p class="task__description">\n                        ${n}\n                    </p>\n                `:""}\n        `,$list.append(t)}));const n=document.querySelectorAll("[data-action='updateTaskIsDone']"),i=document.querySelectorAll("[data-action='deleteTask']"),s=document.querySelectorAll("[data-action='updateTask']");n.forEach((e=>e.addEventListener("change",t))),i.forEach((e=>e.addEventListener("click",a))),s.forEach((t=>t.addEventListener("click",e)))},updateAsideNav=()=>{const e=function(){const e=this.getAttribute("data-name");setFilter({category:e}),setFilteredTasks(),updateAsideNav(),updateList()};$asideNav.innerHTML="",state.categories.forEach((e=>{const t=document.createElement("button");t.classList.add("aside__button","button","button_size_s","button_style_transparent"),e===state.filter.category&&t.classList.add("button_active"),t.setAttribute("data-name",e),t.setAttribute("data-action","setCategory"),t.innerText=e,$asideNav.append(t)})),$asideColumn.innerHTML="";const t=document.createElement("button");t.classList.add("aside__button","button","button_style_transparent","button_size_s"),t.setAttribute("data-action","addCategory"),t.innerText="+ Add new",$asideColumn.append(t);document.querySelectorAll("[data-action='setCategory']").forEach((t=>t.addEventListener("click",e))),t.addEventListener("click",(function(){t.remove();const e=document.createElement("input");e.classList.add("aside__input","input","input_size_s","input_style_white"),e.setAttribute("type","text");const a=document.createElement("button");a.classList.add("aside__button-manage","button","button_style_blue","button_size_xs"),a.innerText="Confirm";const n=document.createElement("button");n.classList.add("aside__button-manage","button","button_style_red","button_size_xs"),n.innerText="Cancel";const i=document.createElement("span");i.classList.add("aside__tag"),$asideColumn.append(e),$asideColumn.append(a),$asideColumn.append(n),$asideColumn.append(i),e.focus(),a.addEventListener("click",(function(){i.innerText="";const t=e.value;checkStrForEmpty(t)?(i.innerText="Empty input!",$asideColumn.append(i)):(setCategories(t),updateAsideNav())})),n.addEventListener("click",(function(){e.remove(),a.remove(),n.remove(),i.remove(),$asideColumn.append(t)}))}))},closeModal=()=>{document.querySelector("[data-name='modal']").remove()},openModal=e=>{const t=state.modal.type;let a;const n=document.createElement("section");n.classList.add("modal"),n.setAttribute("data-name","modal"),n.innerHTML=`\n            <div class="window">\n                <button class="window__button-close button button_style_transparent" data-action="closeModal">\n                    <img class="window__button-icon" src="img/remove.svg" alt="close">\n                </button>\n                <h2 class="window__title title">\n                    ${"update"===state.modal.type?"Update Task":"Add Task"}\n                </h2>\n                <div class="window__row" data-name="name">\n                    <h2 class="window__subtitle">\n                        Enter name\n                    </h2>\n                    <input data-name="inputName"\n                        class="window__input input input_style_white input_size_s"\n                        type="text" data-name="inputName">\n                </div>\n                <div class="window__row" data-name="description">\n                    <h2 class="window__subtitle">\n                        Enter description\n                    </h2>\n                    <div data-name="inputDescription" contenteditable="true"\n                        class="window__input-div input input_style_white input_size_s" type="text"\n                        data-name="inputDescription">\n                    </div>\n                </div>\n                <div class="window__row flex">\n                    <div class="window__column" data-name="setPriority">\n                        <h2 class="window__subtitle">\n                            Choose the priority\n                        </h2>\n                        <label class="window__priority flex flex_align_center">\n                            <input type="radio" name="priority" checked data-name="inputPriority" data-priority="1">\n                            <span class="window__priority-checkmark"></span>\n                            <div class="window__priority-info flex flex_align_center">\n                                <img class="window__priority-icon" src="img/priorities/1.svg" alt="very-low"\n                                    title="Very Low">\n                                <span class="window__priority-name">\n                                    Very Low\n                                </span>\n                            </div>\n                        </label>\n                        <label class="window__priority flex flex_align_center">\n                            <input type="radio" name="priority" data-name="inputPriority" data-priority="2">\n                            <span class="window__priority-checkmark"></span>\n                            <div class="window__priority-info flex flex_align_center">\n                                <img class="window__priority-icon" src="img/priorities/2.svg" alt="low" title="Low">\n                                <span class="window__priority-name">\n                                    Low\n                                </span>\n                            </div>\n                        </label>\n                        <label class="window__priority flex flex_align_center">\n                            <input type="radio" name="priority" data-name="inputPriority" data-priority="3">\n                            <span class="window__priority-checkmark"></span>\n                            <div class="window__priority-info flex flex_align_center">\n                                <img class="window__priority-icon" src="img/priorities/3.svg" alt="medium"\n                                    title="Medium">\n                                <span class="window__priority-name">\n                                    Medium\n                                </span>\n                            </div>\n                        </label>\n                        <label class="window__priority flex flex_align_center">\n                            <input type="radio" name="priority" data-name="inputPriority" data-priority="4">\n                            <span class="window__priority-checkmark"></span>\n                            <div class="window__priority-info flex flex_align_center">\n                                <img class="window__priority-icon" src="img/priorities/4.svg" alt="very-low"\n                                    title="High">\n                                <span class="window__priority-name">\n                                    High\n                                </span>\n                            </div>\n                        </label>\n                        <label class="window__priority flex flex_align_center">\n                            <input type="radio" name="priority" data-name="inputPriority" data-priority="5">\n                            <span class="window__priority-checkmark"></span>\n                            <div class="window__priority-info flex flex_align_center">\n                                <img class="window__priority-icon" src="img/priorities/5.svg" alt="very-high"\n                                    title="Very High">\n                                <span class="window__priority-name">\n                                    Very High\n                                </span>\n                            </div>\n                        </label>\n                    </div>\n                    <div class="window__column" data-name="deadline">\n                        <h2 class="window__subtitle">\n                            Enter deadline\n                        </h2>\n                        <input type="text" class="window__input input input_style_white input_size_s"\n                            placeholder="YYYY-MM-DD HH:MM" data-name="inputDeadline">\n                    </div>\n                    <div class="window__column" data-name="category">\n                        <h2 class="window__subtitle">\n                            Choose the category\n                        </h2>\n                        <select class="window__select select select_size_s select_style_white" data-name="inputCategory">\n                            <option value="default" selected disabled>Categories</option>\n                            ${function(){let e="";return state.categories.filter((e=>"See All"!==e)).forEach((t=>{e+=`\n                                    <option value="${t}">\n                                        ${t}\n                                    </option>\n                                `})),e}()}\n                        </select>\n                    </div>\n                </div>\n                <div class="window__row">\n                    <button class="window__button-add button button_style_blue button_size_s" data-action="confirm">\n                        Confirm\n                    </button>\n                </div>\n            </div>\n        `,$main.append(n);const i=document.querySelector("[data-action='confirm']"),s=document.querySelector("[data-action='closeModal']"),o=document.querySelector("[data-name='name']"),d=document.querySelector("[data-name='description']"),r=document.querySelector("[data-name='deadline']"),l=document.querySelector("[data-name='category']"),c=document.querySelector("[data-name='inputName']"),u=document.querySelector("[data-name='inputDescription']"),p=document.querySelectorAll("[data-name='inputPriority']"),_=document.querySelector("[data-name='inputDeadline']"),m=document.querySelector("[data-name='inputCategory']");s.addEventListener("click",(function(){setModal({isOpen:!1,type:null}),closeModal()})),i.addEventListener("click",(function(){const e=c.value,n=u.innerText,i=_.value,s=m.selectedOptions[0].value,y=parseInt([...p].filter((e=>e.checked))[0].getAttribute("data-priority")),w=checkStrForEmpty(e),b=checkStrForEmpty(n),g=(v=/\d\d\d\d-\d\d-\d\d \d\d:\d\d/gm,null===i.match(v));var v;const k="default"===s,h=document.querySelectorAll(".window__label");0!==h.length&&h.forEach((e=>e.remove()));let f=!0;if(w){const e=document.createElement("p");e.classList.add("window__label"),e.innerText="Enter name, please (max 64 symbols)",o.append(e),f=!1}if(b){const e=document.createElement("p");e.classList.add("window__label"),e.innerHTML="Enter description, please (max 256 symbols)",d.append(e),f=!1}if(g){const e=document.createElement("p");e.classList.add("window__label"),e.innerHTML="\n                Enter deadline, please\n                <br>\n                (valid format: YYYY-MM-DD)\n            ",r.append(e),f=!1}if(k){const e=document.createElement("p");e.classList.add("window__label"),e.innerHTML="Choose the category, please",l.append(e),f=!1}if(f&&"add"===t)setTasks([{id:Date.now(),name:e,description:n,deadline:i,isDone:!1,category:s,priority:y}]),setFilteredTasks(),closeModal(),updateList();else{if(!f||"update"!==t)return;updateTask(a,{name:e,description:n,deadline:i,category:s,priority:y}),setFilteredTasks(),closeModal(),updateList()}})),"update"===t&&(c.value=e.name,u.innerText=e.description,[...p].filter((t=>parseInt(t.getAttribute("data-priority"))===e.priority))[0].checked=!0,_.value=e.deadline,function(){let t;state.categories.forEach(((a,n)=>{a===e.category&&(t=n)})),m.selectedIndex=t}(),a=e.id)},buttonMenuClickHandler=()=>{var e;e=!state.aside,state.aside=e,state.aside?($aside.classList.add("aside_active"),$buttonMenu.classList.add("header__button_active"),$todo.classList.add("todo_disabled")):($aside.classList.remove("aside_active"),$buttonMenu.classList.remove("header__button_active"),$todo.classList.remove("todo_disabled"))},selectSortChangeHandler=e=>{const t=e.target.value;setFilter({sort:t}),setFilteredTasks(),updateList()},searchInputHandler=e=>{const t=e.target.value;setFilter({searchQuery:t}),setFilteredTasks(),updateList()},buttonAddClickHandler=()=>{setModal({isOpen:!0,type:"add"}),openModal()};$buttonAdd.addEventListener("click",buttonAddClickHandler),$buttonMenu.addEventListener("click",buttonMenuClickHandler),$selectSort.addEventListener("change",selectSortChangeHandler),$inputSearch.addEventListener("input",funcDebounce(searchInputHandler,500)),setTasks(initialTasks),setFilteredTasks(),setCategories(),updateAsideNav(),updateList();