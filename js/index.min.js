const INITIAL_TASKS=[{id:0,name:"Visit Spain",description:"Visit Madrid, Barcelona. Also visit El Classico",priority:1,isDone:!0,deadline:"2023-10-13 00:00",category:"Travelling"},{id:1,name:"Build PC",description:"Need more than $2000",priority:3,isDone:!1,deadline:"2022-11-01 00:00",category:"Hobby"},{id:2,name:"Rent an apartment in Moscow",description:null,priority:5,isDone:!1,deadline:"2022-12-31 00:00",category:"Lifestyle"},{id:3,name:"Buy a Monitor",description:null,priority:2,isDone:!0,deadline:"2022-09-30 00:00",category:"Hobby"},{id:4,name:"Read the book",description:null,priority:4,isDone:!0,deadline:"2022-09-21 00:00",category:"Hobby"},{id:5,name:"Meet with Gleb",description:null,priority:2,isDone:!0,deadline:"2022-08-23 00:00",category:"Lifestyle"}],INITIAL_CATEGORIES=[{id:0,name:"See All"},{id:1,name:"Travelling"},{id:2,name:"Hobby"},{id:3,name:"Lifestyle"}],debounce=function(t,e){let n;return function(){const a=()=>{t.apply(this,arguments)};clearTimeout(n),n=setTimeout(a,e)}},checkStrForEmpty=function(t){return""===t.replace(/ +?/g,"")},checkStrForValid=function(t,e){return null===t.match(e)},$=function(t){return document.querySelector(t)},$$=function(t){return document.querySelectorAll(t)},state={modal:{isOpen:!1,type:null},tasks:[],filteredTasks:[],categories:[],filter:{sort:null,searchQuery:null,categoryName:"See All"}},setModal=function(t){state.modal={...t}},setFilter=function(t={}){state.filter={...state.filter,...t}},setCategories=function(t=[]){state.categories=[...state.categories,...t]},setTasks=function(t=[]){state.tasks=[...state.tasks,...t]},updateTask=function(t,e){const n=state.tasks.find((e=>e.id===t)),a=state.tasks.findIndex((e=>e.id===t));state.tasks.splice(a,1,{...n,...e})},deleteTask=function(t){const e=state.tasks.findIndex((e=>e.id===t));state.tasks.splice(e,1)},setFilteredTasks=function(t=state.tasks,e=state.filter){const n=function(t,e){return null===e?t:"name"===e?[...t].sort(((t,e)=>t.name.localeCompare(e.name))):"deadline"===e?[...t].sort(((t,e)=>new Date(t.deadline).getTime()-new Date(e.deadline).getTime())):"priority (asc)"===e?[...t].sort(((t,e)=>t.priority-e.priority)):"priority (desc)"===e?[...t].sort(((t,e)=>e.priority-t.priority)):"status"===e?[...t].sort(((t,e)=>e.isDone-t.isDone)):"description"===e?[...t].sort(((t,e)=>{const n=t.description||"";return(e.description||"").localeCompare(n)})):void 0}(t,e.sort),a=function(t,e){return null===e?t:t.filter((t=>t.name.toLowerCase().includes(e.toLowerCase())))}(n,e.searchQuery),i=function(t,e){return"See All"===e?t:t.filter((t=>t.category===e))}(a,e.categoryName);state.filteredTasks=i},$aside=$("[data-name='aside']"),$asideColumn=$("[data-name='asideColumn']"),$asideNav=$("[data-name='asideNav']"),$buttonAdd=$("[data-action='addTask']"),$buttonMenu=$("[data-action='manageMenu']"),$inputSearch=$("[data-action='searchTasks']"),$list=$("[data-name='list']"),$main=$("[data-name='main']"),$selectSort=$("[data-action='sortTasks']"),$todo=$("[data-name='todo']"),updateAside=function(){$aside.classList.toggle("aside_active"),$buttonMenu.classList.toggle("header__button_active"),$todo.classList.toggle("todo_disabled")},updateList=function(){const t=function(){const t=parseInt(this.getAttribute("data-id")),e=state.tasks.filter((e=>e.id===t))[0];setModal({isOpen:!0,type:"update"}),openModal(e)},e=function(t){const e=t.target.checked,n=parseInt(t.target.getAttribute("data-id"));updateTask(n,{isDone:e}),setFilteredTasks(),updateList()},n=function(){const t=parseInt(this.getAttribute("data-id"));deleteTask(t),setFilteredTasks(),updateList()};console.log("Filter:",state.filter,"\nTasks:",state.tasks,"\nCategories:",state.categories),$list.innerHTML="",state.filteredTasks.forEach((t=>{const e=document.createElement("div");var n,a,i,s;e.classList.add("list__task","task"),e.innerHTML=`\n            <div class="task__row flex flex_align_center">\n                <label class="task__label">\n                    ${i=(n=t).id,s=n.isDone,s?`<input type="checkbox" data-action="updateTaskIsDone" checked data-id="${i}">`:`<input type="checkbox" data-action="updateTaskIsDone" data-id="${i}">`}\n                    <span class="task__checkmark"></span>\n                </label>\n                <img class="task__icon" src="img/priorities/${n.priority}.svg" ${function(t){let e="";switch(t){case 1:e="alt='very-low' title='Very Low Priority'";break;case 2:e="alt='low' title='Low Priority'";break;case 3:e="alt='medium' title='Medium Priority'";break;case 4:e="alt='high' title='High Priority'";break;case 5:e="alt='very-high' title='Very High Priority'"}return e}(n.priority)}>\n                <h2 class="task__name">${n.name}</h2>\n                <div class="task__date-block flex flex_align_center">\n                    <img class="task__icon" src="img/calendar.svg" alt="Calendar">\n                    <span class="task__date-value">${function(t){const e=new Date(`${new Date(Date.now())}`.slice(4,15)),n=new Date(t),a=(n-e)/864e5;return a>1?`${n}`.slice(4,15):1===a?"tomorrow":0===a?"today":"overdue"}(n.deadline)}</span>\n                </div>\n                <div class="task__category-block">\n                    <span class="task__category">\n                        ${n.category}\n                    </span>\n                </div>\n                <div class="task__column">\n                    <button class="task__button button button_style_transparent" data-id="${n.id}"\n                        data-action="updateTask">\n                        <img class="task__icon" src="img/info.svg" alt="info" title="Update Task">\n                    </button>\n                    <button class="task__button button button_style_transparent" data-id="${n.id}"\n                        data-action="deleteTask">\n                        <img class="task__icon" src="img/remove.svg" alt="remove" title="Delete Task">\n                    </button>\n                </div>\n            </div>\n            ${a=n.description,a?`\n                    <p class="task__description">\n                        ${a}\n                    </p>\n                `:""}\n        `,$list.append(e)}));const a=$$("[data-action='updateTaskIsDone']"),i=$$("[data-action='deleteTask']"),s=$$("[data-action='updateTask']");a.forEach((t=>t.addEventListener("change",e))),i.forEach((t=>t.addEventListener("click",n))),s.forEach((e=>e.addEventListener("click",t)))},updateAsideNav=function(){const t=function(){const t=parseInt(this.getAttribute("data-id")),e=state.categories.find((e=>e.id===t)).name;setFilter({categoryName:e}),setFilteredTasks(),updateAsideNav(),updateList()};$asideNav.innerHTML="",state.categories.forEach((t=>{const e=document.createElement("button");e.classList.add("aside__button","button","button_size_s","button_style_transparent"),t.name===state.filter.categoryName&&e.classList.add("button_active"),e.setAttribute("data-id",t.id),e.setAttribute("data-action","setCategory"),e.innerHTML=`${t.name}`,$asideNav.append(e)})),$asideColumn.innerHTML="";const e=document.createElement("button");e.classList.add("aside__button","button","button_style_transparent","button_size_s"),e.setAttribute("data-action","addCategory"),e.innerText="+ Add new",$asideColumn.append(e);const n=$$("[data-action='setCategory']");$("[data-name='subtitle']").innerText=state.filter.categoryName,n.forEach((e=>e.addEventListener("click",t))),e.addEventListener("click",(function(){e.remove();const t=document.createElement("input");t.classList.add("aside__input","input","input_size_s","input_style_white"),t.setAttribute("type","text");const n=document.createElement("button");n.classList.add("aside__button-manage","button","button_style_blue","button_size_xs"),n.innerText="Confirm";const a=document.createElement("button");a.classList.add("aside__button-manage","button","button_style_red","button_size_xs"),a.innerText="Cancel";const i=document.createElement("span");i.classList.add("aside__tag"),$asideColumn.append(t),$asideColumn.append(n),$asideColumn.append(a),$asideColumn.append(i),t.focus(),n.addEventListener("click",(function(){i.innerText="";const e=t.value,n=checkStrForEmpty(e);n||!!state.categories.find((t=>t.name===e))?(i.innerText=!0===n?"Empty input":"Input category already exists",$asideColumn.append(i)):(setCategories([{name:e,id:Date.now()}]),updateAsideNav())})),a.addEventListener("click",(function(){t.remove(),n.remove(),a.remove(),i.remove(),$asideColumn.append(e)}))}))},closeModal=function(){$("[data-name='modal']").remove()},openModal=function(t){const e=state.modal.type;let n;const a=document.createElement("section");a.classList.add("modal"),a.setAttribute("data-name","modal"),a.innerHTML=`\n            <div class="window">\n                <button class="window__button-close button button_style_transparent" data-action="closeModal">\n                    <img class="window__button-icon" src="img/remove.svg" alt="close">\n                </button>\n                <h2 class="window__title title">\n                    ${"update"===state.modal.type?"Update Task":"Add Task"}\n                </h2>\n                <div class="window__row" data-name="name">\n                    <h2 class="window__subtitle">\n                        Enter name\n                    </h2>\n                    <input data-name="inputName"\n                        class="window__input input input_style_white input_size_s"\n                        type="text" data-name="inputName">\n                    <p class="window__label" data-name="labelName">\n                    </p>\n                </div>\n                <div class="window__row" data-name="description">\n                    <h2 class="window__subtitle">\n                        Enter description\n                    </h2>\n                    <div data-name="inputDescription" contenteditable="true"\n                        class="window__input-div input input_style_white input_size_s" type="text"\n                        data-name="inputDescription">\n                    </div>\n                    <p class="window__label" data-name="labelDescription">\n                    </p>\n                </div>\n                <div class="window__row flex">\n                    <div class="window__column" data-name="setPriority">\n                        <h2 class="window__subtitle">\n                            Choose the priority\n                        </h2>\n                        <label class="window__priority flex flex_align_center">\n                            <input type="radio" name="priority" checked data-name="inputPriority" data-priority="1">\n                            <span class="window__priority-checkmark"></span>\n                            <div class="window__priority-info flex flex_align_center">\n                                <img class="window__priority-icon" src="img/priorities/1.svg" alt="very-low"\n                                    title="Very Low">\n                                <span class="window__priority-name">\n                                    Very Low\n                                </span>\n                            </div>\n                        </label>\n                        <label class="window__priority flex flex_align_center">\n                            <input type="radio" name="priority" data-name="inputPriority" data-priority="2">\n                            <span class="window__priority-checkmark"></span>\n                            <div class="window__priority-info flex flex_align_center">\n                                <img class="window__priority-icon" src="img/priorities/2.svg" alt="low" title="Low">\n                                <span class="window__priority-name">\n                                    Low\n                                </span>\n                            </div>\n                        </label>\n                        <label class="window__priority flex flex_align_center">\n                            <input type="radio" name="priority" data-name="inputPriority" data-priority="3">\n                            <span class="window__priority-checkmark"></span>\n                            <div class="window__priority-info flex flex_align_center">\n                                <img class="window__priority-icon" src="img/priorities/3.svg" alt="medium"\n                                    title="Medium">\n                                <span class="window__priority-name">\n                                    Medium\n                                </span>\n                            </div>\n                        </label>\n                        <label class="window__priority flex flex_align_center">\n                            <input type="radio" name="priority" data-name="inputPriority" data-priority="4">\n                            <span class="window__priority-checkmark"></span>\n                            <div class="window__priority-info flex flex_align_center">\n                                <img class="window__priority-icon" src="img/priorities/4.svg" alt="very-low"\n                                    title="High">\n                                <span class="window__priority-name">\n                                    High\n                                </span>\n                            </div>\n                        </label>\n                        <label class="window__priority flex flex_align_center">\n                            <input type="radio" name="priority" data-name="inputPriority" data-priority="5">\n                            <span class="window__priority-checkmark"></span>\n                            <div class="window__priority-info flex flex_align_center">\n                                <img class="window__priority-icon" src="img/priorities/5.svg" alt="very-high"\n                                    title="Very High">\n                                <span class="window__priority-name">\n                                    Very High\n                                </span>\n                            </div>\n                        </label>\n                    </div>\n                    <div class="window__column" data-name="deadline">\n                        <h2 class="window__subtitle">\n                            Enter deadline\n                        </h2>\n                        <input type="text" class="window__input input input_style_white input_size_s"\n                            placeholder="YYYY-MM-DD" data-name="inputDeadline" maxlength="10">\n                        <p class="window__label window__label_size_m" data-name="labelDeadline">\n                        </p>\n                    </div>\n                    <div class="window__column" data-name="category">\n                        <h2 class="window__subtitle">\n                            Choose the category\n                        </h2>\n                        <select class="window__select select select_size_s select_style_white" data-name="inputCategory">\n                            <option value="default" selected disabled>Categories</option>\n                            ${function(){let t="";return state.categories.filter((t=>"See All"!==t.name)).forEach((e=>{t+=`\n                                    <option value="${e.name}" data-id=${e.id}>\n                                        ${e.name}\n                                    </option>\n                                `})),t}()}\n                        </select>\n                        <p class="window__label" data-name="labelCategory">\n                        </p>\n                    </div>\n                </div>\n                <div class="window__row">\n                    <button class="window__button-add button button_style_blue button_size_s" data-action="confirm">\n                        Confirm\n                    </button>\n                </div>\n            </div>\n        `,$main.append(a);const i=$("[data-action='confirm']"),s=$("[data-action='closeModal']"),o=$("[data-name='inputName']"),d=$("[data-name='inputDescription']"),r=$$("[data-name='inputPriority']"),l=$("[data-name='inputDeadline']"),c=$("[data-name='inputCategory']");s.addEventListener("click",(function(){setModal({isOpen:!1,type:null}),closeModal()})),i.addEventListener("click",(function(){const t=o.value,a=d.innerText,i=l.value,s=c.selectedOptions[0].value,u=parseInt([...r].filter((t=>t.checked))[0].getAttribute("data-priority")),p=checkStrForEmpty(t),_=checkStrForEmpty(a),m=(y=/\d\d\d\d-\d\d-\d\d/gm,null===i.match(y));var y;const w="default"===s;$$(".window__label").forEach((t=>t.innerText=""));let g=!0;if(p||t.length>64){document.querySelector("[data-name='labelName']").innerText="Enter name, please (max 64 symbols)",g=!1}if(_||a.length>256){document.querySelector("[data-name='labelDescription']").innerText="Enter description, please (max 256 symbols)",g=!1}if(m){document.querySelector("[data-name='labelDeadline']").innerText="Enter deadline, please\n            (valid format: YYYY-MM-DD)",g=!1}if(w){document.querySelector("[data-name='labelCategory']").innerText="Choose the category, please",g=!1}if(g&&"add"===e)setTasks([{id:Date.now(),name:t,description:a,deadline:`${i} 00:00`,isDone:!1,category:s,priority:u}]),setFilteredTasks(),closeModal(),updateList();else{if(!g||"update"!==e)return;updateTask(n,{name:t,description:a,deadline:`${i} 00:00`,category:s,priority:u}),setFilteredTasks(),closeModal(),updateList()}})),"update"===e&&(o.value=t.name,d.innerText=t.description,[...r].filter((e=>parseInt(e.getAttribute("data-priority"))===t.priority))[0].checked=!0,l.value=t.deadline.slice(0,10),function(){let e=state.categories.findIndex((e=>e.name===t.category));c.selectedIndex=e}(),n=t.id)},buttonMenuClickHandler=function(){$aside.classList.toggle("aside_active"),$buttonMenu.classList.toggle("header__button_active"),$todo.classList.toggle("todo_disabled")},selectSortChangeHandler=function(t){const e=t.target.value;setFilter({sort:e}),setFilteredTasks(),updateList()},searchInputHandler=function(t){const e=t.target.value;setFilter({searchQuery:e}),setFilteredTasks(),updateList()},buttonAddClickHandler=function(){setModal({isOpen:!0,type:"add"}),openModal()};$buttonAdd.addEventListener("click",buttonAddClickHandler),$buttonMenu.addEventListener("click",buttonMenuClickHandler),$selectSort.addEventListener("change",selectSortChangeHandler),$inputSearch.addEventListener("input",debounce(searchInputHandler,500)),setTasks(INITIAL_TASKS),setFilteredTasks(),setCategories(INITIAL_CATEGORIES),updateAsideNav(),updateList();