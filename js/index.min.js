const initialTasks=[{id:0,name:"Visit Spain",description:"Visit Madrid, Barcelona. Also visit El Classico",priority:1,isDone:!0,deadline:"2023-10-13 17:27",category:"Travelling"},{id:1,name:"Build PC",description:"Need more than $2000",priority:3,isDone:!1,deadline:"2022-11-01 18:00",category:"Hobby"},{id:2,name:"Rent an apartment in Moscow",description:null,priority:5,isDone:!1,deadline:"2022-12-31 21:00",category:"Lifestyle"},{id:3,name:"Buy a Monitor",description:null,priority:2,isDone:!0,deadline:"2022-09-30 21:00",category:"Hobby"},{id:4,name:"Read the book",description:null,priority:4,isDone:!0,deadline:"2022-09-23 21:00",category:"Hobby"},{id:5,name:"Meet with Gleb",description:null,priority:2,isDone:!0,deadline:"2022-08-23 21:00",category:"Lifestyle"}],funcDebounce=function(t,e){let a;return function(){const n=()=>{t.apply(this,arguments)};clearTimeout(a),a=setTimeout(n,e)}},checkStrForEmpty=t=>""===t.replace(/ +?/g,""),checkStrForValid=(t,e)=>null===t.match(e),$=t=>document.querySelector(t),$$=t=>document.querySelectorAll(t),state={aside:!1,modal:{isOpen:!1,type:null},tasks:[],filteredTasks:[],categories:["See All"],filter:{sort:null,searchQuery:null,category:"See All"}},setAside=t=>state.aside=t,setModal=t=>state.modal={...t},setFilter=(t={})=>state.filter={...state.filter,...t},setCategories=(t=null)=>{state.categories=[...new Set([...state.categories,...state.tasks.map((t=>t.category))])],null!==t&&(state.categories=[...new Set([...state.categories,t])])},setTasks=(t=[])=>state.tasks=[...state.tasks,...t],updateTask=(t,e)=>{state.tasks.forEach(((a,n)=>{a.id===t&&state.tasks.splice(n,1,{...a,...e})}))},deleteTask=t=>{state.tasks.forEach(((e,a)=>{e.id===t&&state.tasks.splice(a,1)}))},setFilteredTasks=(t=state.tasks,e=state.filter)=>{const a=function(t,e){return null===e?t:"name"===e?[...t].sort(((t,e)=>t.name.localeCompare(e.name))):"deadline"===e?[...t].sort(((t,e)=>new Date(t.deadline).getTime()-new Date(e.deadline).getTime())):"priority (asc)"===e?[...t].sort(((t,e)=>t.priority-e.priority)):"priority (desc)"===e?[...t].sort(((t,e)=>e.priority-t.priority)):"status"===e?[...t].sort(((t,e)=>e.isDone-t.isDone)):"description"===e?[...t].sort(((t,e)=>(t.description||"")-(e.description||""))):void 0}(t,e.sort),n=function(t,e){return null===e?t:t.filter((t=>t.name.toLowerCase().includes(e.toLowerCase())))}(a,e.searchQuery),i=function(t,e){return"See All"===e?t:t.filter((t=>t.category===e))}(n,e.category);state.filteredTasks=i},$aside=$("[data-name='aside']"),$asideColumn=$("[data-name='asideColumn']"),$asideNav=$("[data-name='asideNav']"),$buttonAdd=$("[data-action='addTask']"),$buttonMenu=$("[data-action='manageMenu']"),$inputSearch=$("[data-action='searchTasks']"),$list=$("[data-name='list']"),$main=$("[data-name='main']"),$selectSort=$("[data-action='sortTasks']"),$todo=$("[data-name='todo']"),updateAside=()=>{state.aside?($aside.classList.add("aside_active"),$buttonMenu.classList.add("header__button_active"),$todo.classList.add("todo_disabled")):($aside.classList.remove("aside_active"),$buttonMenu.classList.remove("header__button_active"),$todo.classList.remove("todo_disabled"))},updateList=()=>{const t=function(){const t=parseInt(this.getAttribute("data-id")),e=state.tasks.filter((e=>e.id===t))[0];setModal({isOpen:!0,type:"update"}),openModal(e)},e=t=>{const e=t.target.checked,a=parseInt(t.target.getAttribute("data-id"));updateTask(a,{isDone:e}),setFilteredTasks(),updateList()},a=function(){const t=parseInt(this.getAttribute("data-id"));deleteTask(t),setFilteredTasks(),updateList()};console.log("Tasks:",state.filteredTasks),$list.innerHTML="",state.filteredTasks.forEach((t=>{const e=document.createElement("div");var a,n,i,s;e.classList.add("list__task","task"),e.innerHTML=`\n            <div class="task__row flex flex_align_center">\n                <label class="task__label">\n                    ${i=(a=t).id,s=a.isDone,s?`<input type="checkbox" data-action="updateTaskIsDone" checked data-id="${i}">`:`<input type="checkbox" data-action="updateTaskIsDone" data-id="${i}">`}\n                    <span class="task__checkmark"></span>\n                </label>\n                <img class="task__icon" src="img/priorities/${a.priority}.svg" ${function(t){let e="";switch(t){case 1:e="alt='very-low' title='Very Low Priority'";break;case 2:e="alt='low' title='Low Priority'";break;case 3:e="alt='medium' title='Medium Priority'";break;case 4:e="alt='high' title='High Priority'";break;case 5:e="alt='very-high' title='Very High Priority'"}return e}(a.priority)}>\n                <h2 class="task__name">${a.name}</h2>\n                <div class="task__date-block flex flex_align_center">\n                    <img class="task__icon" src="img/calendar.svg" alt="Calendar">\n                    <span class="task__date-value">${function(t){const e=new Date(t).getTime()-Date.now(),a=new Date(t).getMonth();let n=30;return[0,2,4,6,7,9,11].includes(a)&&(n+=1),e>=31536e6?"year+":e>=864e5*n?"month+":e>=6048e5?"week+":e>=864e5?"day+":e>=36e5?"hour+":e>=6e4?"minute+":"overdue"}(a.deadline)}</span>\n                </div>\n                <span class="task__category">\n                    ${a.category}\n                </span>\n                <div class="task__column">\n                    <button class="task__button button button_style_transparent" data-id="${a.id}"\n                        data-action="updateTask">\n                        <img class="task__icon" src="img/info.svg" alt="info" title="Update Task">\n                    </button>\n                    <button class="task__button button button_style_transparent" data-id="${a.id}"\n                        data-action="deleteTask">\n                        <img class="task__icon" src="img/remove.svg" alt="remove" title="Delete Task">\n                    </button>\n                </div>\n            </div>\n            ${n=a.description,n?`\n                    <p class="task__description">\n                        ${n}\n                    </p>\n                `:""}\n        `,$list.append(e)}));const n=$$("[data-action='updateTaskIsDone']"),i=$$("[data-action='deleteTask']"),s=$$("[data-action='updateTask']");n.forEach((t=>t.addEventListener("change",e))),i.forEach((t=>t.addEventListener("click",a))),s.forEach((e=>e.addEventListener("click",t)))},updateAsideNav=()=>{const t=function(){const t=this.getAttribute("data-name");setFilter({category:t}),setFilteredTasks(),updateAsideNav(),updateList()};$asideNav.innerHTML="",state.categories.forEach((t=>{const e=document.createElement("button");e.classList.add("aside__button","button","button_size_s","button_style_transparent"),t===state.filter.category&&e.classList.add("button_active"),e.setAttribute("data-name",t),e.setAttribute("data-action","setCategory"),e.innerText=t,$asideNav.append(e)})),$asideColumn.innerHTML="";const e=document.createElement("button");e.classList.add("aside__button","button","button_style_transparent","button_size_s"),e.setAttribute("data-action","addCategory"),e.innerText="+ Add new",$asideColumn.append(e);$$("[data-action='setCategory']").forEach((e=>e.addEventListener("click",t))),e.addEventListener("click",(function(){e.remove();const t=document.createElement("input");t.classList.add("aside__input","input","input_size_s","input_style_white"),t.setAttribute("type","text");const a=document.createElement("button");a.classList.add("aside__button-manage","button","button_style_blue","button_size_xs"),a.innerText="Confirm";const n=document.createElement("button");n.classList.add("aside__button-manage","button","button_style_red","button_size_xs"),n.innerText="Cancel";const i=document.createElement("span");i.classList.add("aside__tag"),$asideColumn.append(t),$asideColumn.append(a),$asideColumn.append(n),$asideColumn.append(i),t.focus(),a.addEventListener("click",(function(){i.innerText="";const e=t.value;checkStrForEmpty(e)?(i.innerText="Empty input!",$asideColumn.append(i)):(setCategories(e),updateAsideNav())})),n.addEventListener("click",(function(){t.remove(),a.remove(),n.remove(),i.remove(),$asideColumn.append(e)}))}))},closeModal=()=>{$("[data-name='modal']").remove()},openModal=t=>{const e=state.modal.type;let a;const n=document.createElement("section");n.classList.add("modal"),n.setAttribute("data-name","modal"),n.innerHTML=`\n            <div class="window">\n                <button class="window__button-close button button_style_transparent" data-action="closeModal">\n                    <img class="window__button-icon" src="img/remove.svg" alt="close">\n                </button>\n                <h2 class="window__title title">\n                    ${"update"===state.modal.type?"Update Task":"Add Task"}\n                </h2>\n                <div class="window__row" data-name="name">\n                    <h2 class="window__subtitle">\n                        Enter name\n                    </h2>\n                    <input data-name="inputName"\n                        class="window__input input input_style_white input_size_s"\n                        type="text" data-name="inputName">\n                </div>\n                <div class="window__row" data-name="description">\n                    <h2 class="window__subtitle">\n                        Enter description\n                    </h2>\n                    <div data-name="inputDescription" contenteditable="true"\n                        class="window__input-div input input_style_white input_size_s" type="text"\n                        data-name="inputDescription">\n                    </div>\n                </div>\n                <div class="window__row flex">\n                    <div class="window__column" data-name="setPriority">\n                        <h2 class="window__subtitle">\n                            Choose the priority\n                        </h2>\n                        <label class="window__priority flex flex_align_center">\n                            <input type="radio" name="priority" checked data-name="inputPriority" data-priority="1">\n                            <span class="window__priority-checkmark"></span>\n                            <div class="window__priority-info flex flex_align_center">\n                                <img class="window__priority-icon" src="img/priorities/1.svg" alt="very-low"\n                                    title="Very Low">\n                                <span class="window__priority-name">\n                                    Very Low\n                                </span>\n                            </div>\n                        </label>\n                        <label class="window__priority flex flex_align_center">\n                            <input type="radio" name="priority" data-name="inputPriority" data-priority="2">\n                            <span class="window__priority-checkmark"></span>\n                            <div class="window__priority-info flex flex_align_center">\n                                <img class="window__priority-icon" src="img/priorities/2.svg" alt="low" title="Low">\n                                <span class="window__priority-name">\n                                    Low\n                                </span>\n                            </div>\n                        </label>\n                        <label class="window__priority flex flex_align_center">\n                            <input type="radio" name="priority" data-name="inputPriority" data-priority="3">\n                            <span class="window__priority-checkmark"></span>\n                            <div class="window__priority-info flex flex_align_center">\n                                <img class="window__priority-icon" src="img/priorities/3.svg" alt="medium"\n                                    title="Medium">\n                                <span class="window__priority-name">\n                                    Medium\n                                </span>\n                            </div>\n                        </label>\n                        <label class="window__priority flex flex_align_center">\n                            <input type="radio" name="priority" data-name="inputPriority" data-priority="4">\n                            <span class="window__priority-checkmark"></span>\n                            <div class="window__priority-info flex flex_align_center">\n                                <img class="window__priority-icon" src="img/priorities/4.svg" alt="very-low"\n                                    title="High">\n                                <span class="window__priority-name">\n                                    High\n                                </span>\n                            </div>\n                        </label>\n                        <label class="window__priority flex flex_align_center">\n                            <input type="radio" name="priority" data-name="inputPriority" data-priority="5">\n                            <span class="window__priority-checkmark"></span>\n                            <div class="window__priority-info flex flex_align_center">\n                                <img class="window__priority-icon" src="img/priorities/5.svg" alt="very-high"\n                                    title="Very High">\n                                <span class="window__priority-name">\n                                    Very High\n                                </span>\n                            </div>\n                        </label>\n                    </div>\n                    <div class="window__column" data-name="deadline">\n                        <h2 class="window__subtitle">\n                            Enter deadline\n                        </h2>\n                        <input type="text" class="window__input input input_style_white input_size_s"\n                            placeholder="YYYY-MM-DD HH:MM" data-name="inputDeadline">\n                    </div>\n                    <div class="window__column" data-name="category">\n                        <h2 class="window__subtitle">\n                            Choose the category\n                        </h2>\n                        <select class="window__select select select_size_s select_style_white" data-name="inputCategory">\n                            <option value="default" selected disabled>Categories</option>\n                            ${function(){let t="";return state.categories.filter((t=>"See All"!==t)).forEach((e=>{t+=`\n                                    <option value="${e}">\n                                        ${e}\n                                    </option>\n                                `})),t}()}\n                        </select>\n                    </div>\n                </div>\n                <div class="window__row">\n                    <button class="window__button-add button button_style_blue button_size_s" data-action="confirm">\n                        Confirm\n                    </button>\n                </div>\n            </div>\n        `,$main.append(n);const i=$("[data-action='confirm']"),s=$("[data-action='closeModal']"),o=$("[data-name='name']"),d=$("[data-name='description']"),r=$("[data-name='deadline']"),l=$("[data-name='category']"),c=$("[data-name='inputName']"),p=$("[data-name='inputDescription']"),u=$$("[data-name='inputPriority']"),_=$("[data-name='inputDeadline']"),m=$("[data-name='inputCategory']");s.addEventListener("click",(function(){setModal({isOpen:!1,type:null}),closeModal()})),i.addEventListener("click",(function(){const t=c.value,n=p.innerText,i=_.value,s=m.selectedOptions[0].value,y=parseInt([...u].filter((t=>t.checked))[0].getAttribute("data-priority")),w=checkStrForEmpty(t),b=checkStrForEmpty(n),g=(v=/\d\d\d\d-\d\d-\d\d \d\d:\d\d/gm,null===i.match(v));var v;const k="default"===s,h=$$(".window__label");0!==h.length&&h.forEach((t=>t.remove()));let f=!0;if(w){const t=document.createElement("p");t.classList.add("window__label"),t.innerText="Enter name, please (max 64 symbols)",o.append(t),f=!1}if(b){const t=document.createElement("p");t.classList.add("window__label"),t.innerHTML="Enter description, please (max 256 symbols)",d.append(t),f=!1}if(g){const t=document.createElement("p");t.classList.add("window__label"),t.innerHTML="\n                Enter deadline, please\n                <br>\n                (valid format: YYYY-MM-DD)\n            ",r.append(t),f=!1}if(k){const t=document.createElement("p");t.classList.add("window__label"),t.innerHTML="Choose the category, please",l.append(t),f=!1}if(f&&"add"===e)setTasks([{id:Date.now(),name:t,description:n,deadline:i,isDone:!1,category:s,priority:y}]),setFilteredTasks(),closeModal(),updateList();else{if(!f||"update"!==e)return;updateTask(a,{name:t,description:n,deadline:i,category:s,priority:y}),setFilteredTasks(),closeModal(),updateList()}})),"update"===e&&(c.value=t.name,p.innerText=t.description,[...u].filter((e=>parseInt(e.getAttribute("data-priority"))===t.priority))[0].checked=!0,_.value=t.deadline,function(){let e;state.categories.forEach(((a,n)=>{a===t.category&&(e=n)})),m.selectedIndex=e}(),a=t.id)},buttonMenuClickHandler=()=>{var t;t=!state.aside,state.aside=t,state.aside?($aside.classList.add("aside_active"),$buttonMenu.classList.add("header__button_active"),$todo.classList.add("todo_disabled")):($aside.classList.remove("aside_active"),$buttonMenu.classList.remove("header__button_active"),$todo.classList.remove("todo_disabled"))},selectSortChangeHandler=t=>{const e=t.target.value;setFilter({sort:e}),setFilteredTasks(),updateList()},searchInputHandler=t=>{const e=t.target.value;setFilter({searchQuery:e}),setFilteredTasks(),updateList()},buttonAddClickHandler=()=>{setModal({isOpen:!0,type:"add"}),openModal()};$buttonAdd.addEventListener("click",buttonAddClickHandler),$buttonMenu.addEventListener("click",buttonMenuClickHandler),$selectSort.addEventListener("change",selectSortChangeHandler),$inputSearch.addEventListener("input",funcDebounce(searchInputHandler,500)),setTasks(initialTasks),setFilteredTasks(),setCategories(),updateAsideNav(),updateList();